<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Creating a sysimage for fast plotting with Plots.jl · PackageCompiler</title><meta name="title" content="Creating a sysimage for fast plotting with Plots.jl · PackageCompiler"/><meta property="og:title" content="Creating a sysimage for fast plotting with Plots.jl · PackageCompiler"/><meta property="twitter:title" content="Creating a sysimage for fast plotting with Plots.jl · PackageCompiler"/><meta name="description" content="Documentation for PackageCompiler."/><meta property="og:description" content="Documentation for PackageCompiler."/><meta property="twitter:description" content="Documentation for PackageCompiler."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">PackageCompiler</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../sysimages.html">Sysimages</a></li><li><a class="tocitem" href="../apps.html">Apps</a></li><li><a class="tocitem" href="../libs.html">Libraries</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="ohmyrepl.html">Creating a sysimage with OhMyREPL</a></li><li class="is-active"><a class="tocitem" href="plots.html">Creating a sysimage for fast plotting with Plots.jl</a></li></ul></li><li><a class="tocitem" href="../refs.html">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="plots.html">Creating a sysimage for fast plotting with Plots.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="plots.html">Creating a sysimage for fast plotting with Plots.jl</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaLang/PackageCompiler.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaLang/PackageCompiler.jl/blob/master/docs/src/examples/plots.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="examples-plots"><a class="docs-heading-anchor" href="#examples-plots">Creating a sysimage for fast plotting with Plots.jl</a><a id="examples-plots-1"></a><a class="docs-heading-anchor-permalink" href="#examples-plots" title="Permalink"></a></h1><div class="admonition is-info"><header class="admonition-header">Julia Version 1.9 Performance Update</header><div class="admonition-body"><p>Starting from Julia 1.9, the &quot;time to first plot&quot; (TTFP) has seen a significant improvement due to the introduction of native code caching with Package Images. While the techniques presented in this guide for creating a custom sysimage remain applicable and beneficial for further optimization, please note that the relative improvement will be less dramatic due to the enhanced performance of code loading and execution in recent Julia versions.</p></div></div><p>A common complaint about Julia is that the &quot;time to first plot&quot; is a bit longer than desired. In this example, we will create a sysimage that is made to improve this.</p><p>To get a reference, we measure the time it takes to create the first plot with the default sysimage:</p><pre><code class="language-julia-repl hljs">julia&gt; @time using Plots
  2.943946 seconds (8.11 M allocations: 567.656 MiB, 6.47% gc time)

julia&gt; @time p = plot(rand(2,2));
  1.940742 seconds (3.29 M allocations: 197.525 MiB, 4.65% gc time)

julia&gt; @time display(p);
  5.132217 seconds (15.00 M allocations: 847.491 MiB, 2.57% gc time, 45.95%)</code></pre><p>This is approximately 19 seconds from the start of Julia to the first plot.</p><p>We now create a precompilation file with exactly this workload in a file called <code>precompile_plots.jl</code> in the current directory:</p><pre><code class="language-julia hljs">using Plots
p = plot(rand(2,2))
display(p)</code></pre><p>The custom sysimage is then created as:</p><pre><code class="language-julia hljs">using PackageCompiler
create_sysimage([&quot;Plots&quot;], sysimage_path=&quot;sys_plots.so&quot;, precompile_execution_file=&quot;precompile_plots.jl&quot;)</code></pre><p>If we now start Julia with the flag <code>--sysimage sys_plots.so</code> and re-time our previous commands:</p><pre><code class="language-julia-repl hljs">julia&gt; @time using Plots
  0.000159 seconds (1.07 k allocations: 79.797 KiB)

julia&gt; @time p = plot(rand(2,2));
  0.037670 seconds (74.09 k allocations: 4.703 MiB)

julia&gt; @time display(p);
  0.331869 seconds (278.38 k allocations: 7.900 MiB)</code></pre><p>which is a sizeable speedup. </p><p>When using the sysimage, you may need to call <code>Plots.__init__()</code> after loading Plots for the plots to display; otherwise, you might need to use <code>gui</code> or  pass argument <code>show = true</code> to <code>plot</code>.</p><p>Note that since we have more stuff in our sysimage, Julia is slightly slower to start (0.35 seconds on this machine):</p><pre><code class="nohighlight hljs"># Default sysimage
➜ time julia -e &#39;&#39;                        
julia -e &#39;&#39;  0.06s user 0.06s system 130% cpu 0.088 total

# Custom sysimage
➜ time julia --sysimage sys_plots.so -e &#39;&#39;
julia --sysimage sys_plots.so -e &#39;&#39;  0.43s user 0.30s system 347% cpu 0.211 total</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="ohmyrepl.html">« Creating a sysimage with OhMyREPL</a><a class="docs-footer-nextpage" href="../refs.html">References »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Tuesday 2 July 2024 14:35">Tuesday 2 July 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
